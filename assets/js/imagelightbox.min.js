! function(e) {
    "object" == typeof module && "object" == typeof module.exports ? e(require("jquery"), window, document) : e(jQuery, window, document)
}(function(C, I, T) {
    "use strict";
    var F = C("<div/>").attr("class", "imagelightbox-loading").append(C("<div/>")),
        e = C("<button/>", {
            type: "button",
            class: "imagelightbox-arrow imagelightbox-arrow-left"
        }),
        t = C("<button/>", {
            type: "button",
            class: "imagelightbox-arrow imagelightbox-arrow-right"
        }),
        P = e.add(t),
        D = C("<div/>", {
            class: "imagelightbox-caption",
            html: "&nbsp;"
        }),
        M = C("<a/>", {
            class: "imagelightbox-close"
        }),
        R = C("<div/>", {
            class: "imagelightbox-overlay"
        }),
        z = C("<a/>", {
            href: "#",
            class: "imagelightbox-navitem"
        }),
        X = C("<div/>", {
            class: "imagelightbox-nav"
        }),
        j = C("<div/>", {
            class: "imagelightbox-wrapper"
        }),
        L = C("body"),
        a = function() {
            var e = T.body || T.documentElement;
            return "" === (e = e.style).WebkitTransition ? "-webkit-" : "" === e.MozTransition ? "-moz-" : "" === e.OTransition ? "-o-" : "" === e.transition && ""
        },
        N = !1 !== a(),
        K = function(e, t, i) {
            var n = {},
                o = a();
            n[o + "transform"] = "translateX(" + t + ") translateY(-50%)", n[o + "transition"] = o + "transform " + i + "s linear", e.css(n)
        },
        U = "ontouchstart" in I,
        Y = I.navigator.pointerEnabled || I.navigator.msPointerEnabled,
        _ = function(e) {
            if (U) return !0;
            if (!Y || void 0 === e || void 0 === e.pointerType) return !1;
            if (void 0 !== e.MSPOINTER_TYPE_MOUSE) {
                if (e.MSPOINTER_TYPE_MOUSE !== e.pointerType) return !0
            } else if ("mouse" !== e.pointerType) return !0;
            return !1
        },
        B = !1 != !!(T.fullscreenEnabled || T.webkitFullscreenEnabled || T.mozFullScreenEnabled || T.msFullscreenEnabled);
    C.fn.imageLightbox = function(e) {
        var c = C.extend({
                selector: "a[data-imagelightbox]",
                id: "imagelightbox",
                allowedTypes: "png|jpg|jpeg|gif",
                animationSpeed: 250,
                activity: !1,
                arrows: !1,
                button: !1,
                caption: !1,
                enableKeyboard: !0,
                fullscreen: !1,
                gutter: 10,
                offsetY: 0,
                navigation: !1,
                overlay: !1,
                preloadNext: !0,
                quitOnEnd: !1,
                quitOnImgClick: !1,
                quitOnDocClick: !0,
                quitOnEscKey: !0
            }, e),
            a = function() {
                c.activity && i(), c.arrows && P.css("display", "block")
            },
            r = function() {
                var e = p.index(d) - 1;
                if (e < 0) {
                    if (!0 === c.quitOnEnd) return S(), !1;
                    e = p.length - 1
                }
                d = p.eq(e), j.trigger("previous.ilb2"), q(1)
            },
            l = function() {
                var e = p.index(d) + 1;
                if (e >= p.length) {
                    if (!0 === c.quitOnEnd) return S(), !1;
                    e = 0
                }
                d = p.eq(e), j.trigger("next.ilb2"), q(-1)
            },
            t = function() {
                j.append(F)
            },
            i = function() {
                C(".imagelightbox-loading").remove()
            },
            n = function() {
                j.append(R)
            },
            o = function() {
                M.appendTo(j).on("click.ilb7", function() {
                    return S(), !1
                })
            },
            u = function() {
                D.html("&nbsp;"), C(d).data("ilb2-caption") ? D.html(C(d).data("ilb2-caption")) : 0 < C(d).find("img").length && D.html(C(d).find("img").attr("alt"))
            },
            s = function() {
                if (p.length) {
                    for (var e = 0; e < p.length; e++) X.append(z.clone());
                    var t = X.children("a");
                    t.eq(p.index(d)).addClass("active"), j.on("previous.ilb2 next.ilb2", function() {
                        t.removeClass("active").eq(p.index(d)).addClass("active")
                    }), j.append(X), X.on("click.ilb7 touchend.ilb7", function() {
                        return !1
                    }).on("click.ilb7 touchend.ilb7", "a", function() {
                        var e = C(this);
                        if (p.eq(e.index()).attr("href") !== C(".imagelightbox").attr("src")) {
                            var t = p.eq(e.index());
                            t.length && (w = p.index(d), d = t, q(e.index() < w ? -1 : 1))
                        }
                        e.addClass("active").siblings().removeClass("active")
                    })
                }
            },
            g = function() {
                j.append(P), P.on("click.ilb7 touchend.ilb7", function(e) {
                    return e.stopImmediatePropagation(), e.preventDefault(), C(this).hasClass("imagelightbox-arrow-left") ? r() : l(), !1
                })
            },
            f = "",
            p = C([]),
            d = C(),
            h = C(),
            b = 0,
            m = 0,
            v = 0,
            x = !1,
            w = 0,
            y = function() {
                if (!h.length) return !0;
                var e = c.caption ? D.outerHeight() : 0,
                    o = C(I).width(),
                    a = C(I).height() - e,
                    r = Math.abs(1 - c.gutter / 100),
                    l = new Image;
                l.src = h.attr("src"), l.onload = function() {
                    if (b = l.width, m = l.height, o < b || a < m) {
                        var e = o / a < b / m ? b / o : m / a;
                        b /= e, m /= e
                    }
                    var t = m * r,
                        i = b * r,
                        n = (C(I).width() - i) / 2;
                    h.css({
                        width: i + "px",
                        height: t + "px",
                        left: n + "px"
                    })
                }
            },
            q = function(o) {
                if (x) return !1;
                if (h.length) {
                    var e = {
                        opacity: 0
                    };
                    N ? K(h, 100 * o - v + "px", c.animationSpeed / 1e3) : e.left = parseInt(h.css("left")) + 100 * o + "px", h.animate(e, c.animationSpeed, function() {
                        E()
                    }), v = 0
                }
                x = !0, c.activity && t(), c.caption && u(), setTimeout(function() {
                    var e = d.attr("href");
                    h = C("<img id='" + c.id + "' />").attr("src", e).on("load.ilb7", function() {
                        var e = {
                            opacity: 1
                        };
                        if (h.appendTo(j), y(), h.css("opacity", 0), N) K(h, -100 * o + "px", 0), setTimeout(function() {
                            K(h, "0px", c.animationSpeed / 1e3)
                        }, 50);
                        else {
                            var t = parseInt(h.css("left"));
                            e.left = t + "px", h.css("left", t - 100 * o + "px")
                        }
                        if (h.animate(e, c.animationSpeed, function() {
                                x = !1, a()
                            }), c.preloadNext) {
                            var i = p.eq(p.index(d) + 1);
                            i.length || (i = p.eq(0)), C("<img />").attr("src", i.attr("href"))
                        }
                        j.trigger("loaded.ilb2")
                    }).on("error.ilb7", function() {
                        a()
                    });
                    var t = 0,
                        i = 0,
                        n = 0;
                    h.on(Y ? "pointerup.ilb7 MSPointerUp.ilb7" : "click.ilb7", function(e) {
                        return e.preventDefault(), c.quitOnImgClick ? (S(), !1) : !!_(e.originalEvent) || void((e.pageX || e.originalEvent.pageX) - e.target.offsetLeft < b / 2 ? r() : l())
                    }).on("touchstart.ilb7 pointerdown.ilb7 MSPointerDown.ilb7", function(e) {
                        if (!_(e.originalEvent) || c.quitOnImgClick) return !0;
                        N && (n = parseInt(h.css("left"))), t = e.originalEvent.pageX || e.originalEvent.touches[0].pageX
                    }).on("touchmove.ilb7 pointermove.ilb7 MSPointerMove.ilb7", function(e) {
                        if (!Y && "pointermove" === e.type || !_(e.originalEvent) || c.quitOnImgClick) return !0;
                        e.preventDefault(), i = e.originalEvent.pageX || e.originalEvent.touches[0].pageX, v = t - i, N ? K(h, -v + "px", 0) : h.css("left", n - v + "px")
                    }).on("touchend.ilb7 touchcancel.ilb7 pointerup.ilb7 pointercancel.ilb7 MSPointerUp.ilb7 MSPointerCancel.ilb7", function(e) {
                        if (!_(e.originalEvent) || c.quitOnImgClick) return !0;
                        50 < Math.abs(v) ? v < 0 ? r() : l() : N ? K(h, "0px", c.animationSpeed / 1e3) : h.animate({
                            left: n + "px"
                        }, c.animationSpeed / 2)
                    })
                }, c.animationSpeed + 100)
            },
            E = function() {
                if (!h.length) return !1;
                h.remove(), h = C()
            },
            k = function(e) {
                if (x) return !1;
                x = !1, d = e,
                    function() {
                        c.arrows && g(this), c.navigation && s(), c.overlay && n(), c.button && o(), c.caption && j.append(D)
                    }(), L.append(j).addClass("imagelightbox-open"), j.trigger("start.ilb2"), q(0)
            },
            S = function() {
                if (j.trigger("quit.ilb2"), L.removeClass("imagelightbox-open"), !h.length) return !1;
                h.animate({
                    opacity: 0
                }, c.animationSpeed, function() {
                    E(), x = !1, p = C([]), j.remove().find("*").remove()
                })
            },
            O = function(t) {
                t.on("click.ilb7", {
                    set: f
                }, function(e) {
                    e.preventDefault(), f = C(e.currentTarget).data("imagelightbox"), t.filter(function() {
                        return C(this).data("imagelightbox") === f
                    }).filter(function() {
                        return e = C(this), "a" === C(e).prop("tagName").toLowerCase() && new RegExp(".(" + c.allowedTypes + ")$", "i").test(C(e).attr("href"));
                        var e
                    }).each(function() {
                        p = p.add(C(this))
                    }), p.length < 1 ? S() : k(C(this))
                })
            };
        return C(I).on("resize.ilb7", y), C(T).ready(function() {
            c.quitOnDocClick && C(T).on(U ? "touchend.ilb7" : "click.ilb7", function(e) {
                h.length && !C(e.target).is(h) && (e.preventDefault(), S())
            }), c.fullscreen && B && C(T).on("keydown.ilb7", function(e) {
                if (!h.length) return !0;
                var t; - 1 < [9, 32, 38, 40].indexOf(e.which) && (e.stopPropagation(), e.preventDefault()), -1 < [13].indexOf(e.which) && (e.stopPropagation(), e.preventDefault(), (t = T.getElementById(c.id).parentElement).requestFullscreen ? t.requestFullscreen() : t.mozRequestFullScreen ? t.mozRequestFullScreen() : t.webkitRequestFullscreen ? t.webkitRequestFullscreen() : t.msRequestFullscreen && t.msRequestFullscreen(), T.exitFullscreen ? T.exitFullscreen() : T.mozCancelFullScreen ? T.mozCancelFullScreen() : T.webkitExitFullscreen && T.webkitExitFullscreen())
            }), c.enableKeyboard && C(T).on("keydown.ilb7", function(e) {
                if (!h.length) return !0; - 1 < [27].indexOf(e.which) && c.quitOnEscKey && (e.stopPropagation(), e.preventDefault(), S()), -1 < [37].indexOf(e.which) && (e.stopPropagation(), e.preventDefault(), r()), -1 < [39].indexOf(e.which) && (e.stopPropagation(), e.preventDefault(), l())
            })
        }), C(T).off("click", c.selector), O(C(this)), this.addToImageLightbox = function(e) {
            O(e)
        }, this.loadPreviousImage = function() {
            r()
        }, this.loadNextImage = function() {
            l()
        }, this.quitImageLightbox = function() {
            return S(), this
        }, this.startImageLightbox = function(e) {
            e ? e.trigger("click.ilb7") : C(this).trigger("click.ilb7")
        }, this
    }
});